<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Convoy Planner — Demo UI</title>
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Arial;margin:18px;background:#0f172a;color:#e6eef8}
    .card{background:#0b1220;border:1px solid #17203a;padding:18px;border-radius:8px;box-shadow:0 6px 20px rgba(2,6,23,0.6);max-width:900px;margin:12px auto}
    h1{font-size:20px;margin:0 0 12px}
    label{display:block;margin-top:8px;font-size:13px;color:#bcd3ff}
    input, select, textarea{width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #213149;background:#071125;color:#e6eef8}
    .row{display:flex;gap:12px}
    .col{flex:1}
    button{margin-top:12px;padding:10px 14px;border-radius:8px;border:none;background:#2563eb;color:#fff;cursor:pointer}
    pre{background:#041029;padding:12px;border-radius:6px;overflow:auto;color:#cfe8ff}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:#0b1220;border:1px solid #243b5a;color:#9fd3ff;margin-right:6px}
    .small{font-size:13px;color:#9fb4d9}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{color:#9fb4d9;font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h1>AI Convoy Planner — Demo UI</h1>
    <div class="small">Submit a convoy request to the planner backend and see the filtered graph & A* route result.</div>

    <div style="margin-top:12px">
      <label>Convoy ID<input id="convoy_id" value="TST-H-001"></label>
      <div class="row">
        <div class="col">
          <label>Origin<input id="origin" value="A"></label>
        </div>
        <div class="col">
          <label>Destination<input id="destination" value="D"></label>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Convoy Class
            <select id="convoy_class">
              <option>Light</option>
              <option>Medium</option>
              <option selected>Heavy</option>
            </select>
          </label>
        </div>
        <div class="col">
          <label>Priority Score (0-100)
            <input id="priority_score" type="number" value="68" min="0" max="100">
          </label>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Weight (tons)<input id="weight_tons" type="number" value="22"></label>
        </div>
        <div class="col">
          <label>Height (m)<input id="height_m" type="number" value="3.2" step="0.1"></label>
        </div>
      </div>

      <label>Special flags (comma-separated, e.g. medical)<input id="special_flags" placeholder="medical,VIP"></label>

      <label>Optional: graph path to use (leave empty for canonical)<input id="use_graph" placeholder="person3_world/graph_active_INC-002.json"></label>

      <button id="planBtn">Plan Route</button>
      <div style="margin-top:10px" class="muted">API endpoint: <code>POST http://localhost:5001/plan_route</code></div>
    </div>
  </div>

  <div class="card">
    <h1>Planner Output</h1>
    <div class="grid">
      <div>
        <div class="badge">Filter Log</div>
        <pre id="filterLog">(empty)</pre>
      </div>
      <div>
        <div class="badge">Route Result</div>
        <pre id="routeResult">(empty)</pre>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="badge">Summary</div>
      <div id="summary" class="small">No run yet.</div>
    </div>
  </div>

  <script>
    const planBtn = document.getElementById('planBtn');
    function q(id){return document.getElementById(id)}

    planBtn.addEventListener('click', async ()=>{
      const body = {
        convoy_id: q('convoy_id').value || 'demo',
        origin: q('origin').value || 'A',
        destination: q('destination').value || 'D',
        convoy_class: q('convoy_class').value || 'Light',
        priority_score: Number(q('priority_score').value || 0),
        weight_tons: Number(q('weight_tons').value || 0),
        height_m: Number(q('height_m').value || 0),
        width_m: 3.5,
        special_flags: (q('special_flags').value || '').split(',').map(s=>s.trim()).filter(Boolean)
      };
      const use_graph = (q('use_graph').value || '').trim();
      if(use_graph) body.use_graph = use_graph;

      // UI feedback
      q('filterLog').textContent = 'Requesting...';
      q('routeResult').textContent = '';
      q('summary').textContent = 'Waiting for response...';

      try{
        const resp = await fetch('http://127.0.0.1:5001/plan_route', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(body)
        });
        if(!resp.ok){
          const txt = await resp.text();
          q('filterLog').textContent = 'Error: ' + resp.status + ' ' + txt;
          q('summary').textContent = 'Error';
          return;
        }
        const data = await resp.json();
        const filterLog = data.filter_log || {};
        const route = data.route_result || {};
        q('filterLog').textContent = JSON.stringify(filterLog, null, 2);
        q('routeResult').textContent = JSON.stringify(route, null, 2);
        q('summary').textContent = `Route success: ${route.success} • ETA: ${route.eta_minutes || '-'} min • Total risk: ${route.total_risk || '-'} • Nodes: ${route.route_nodes? route.route_nodes.join(' → '): '-'}`;
      }catch(err){
        q('filterLog').textContent = 'Request failed: ' + err.message;
        q('summary').textContent = 'Request failed';
      }
    });
  </script>
</body>
</html>
